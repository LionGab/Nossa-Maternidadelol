# [Conclusão]

Seu projeto “Nossa Maternidade / Mundo Nath (Nathália Valente)” é um **app mobile-first (Expo + EAS)** com **5 sessões** centrais — **Home | NathIA | MundoNath | MãeValente | Meus Hábitos** — monetizado por **assinatura mensal (R$19,90)**, usando **Supabase** (auth + RLS + Storage + Edge Functions) e **IA dupla**: **Gemini 2.0 Flash** (chat NathIA) e **Perplexity** (curadoria/respostas do MãeValente). O **MVP** que a influenciadora precisa ver é um **fluxo fluido e bonito**, com **navegação estável, conteúdo real**, chat funcional, e **paywall simples** (liberado para testers). A recomendação objetiva: **consolidar no repo “NossaMaternidade-Private”**, ativar **Expo Router + Zustand**, **EAS** pronto para TestFlight/Closed Testing, **RLS mínimo** já ativo, **notificações push**, e **tema azul** padronizado.

---

## [O que já sabemos e está decidido]

* **Público & posicionamento**: mães/gestantes; tom acolhedor, “refúgio sem julgamento”.
* **Identidade**: paleta azul acolhedora (#6DA9E4/#DCEBFA/#FFF8F3; texto #6A5450; accent #FF8BA3).
* **Abas**: Home | NathIA | MundoNath | MãeValente | Meus Hábitos (tabs fixas).
* **IA**:

  * **NathIA** = **Gemini 2.0 Flash** (custo/latência ótimos).
  * **MãeValente** = **Perplexity** (pesquisa/curadoria).
* **Monetização**: **mensal R$19,90** (influenciadora quer app iOS/Android).
* **Stack**: **Expo + EAS**, **Expo Router**, **Zustand**, **Supabase** (pg_cron, RLS, Storage), **Push (Expo Notifications)**.
* **Repositórios**: muitos; **destino** = **NossaMaternidade-Private**.
* **Urgência**: teste privado pela influenciadora (builds reais; nada “em breve”).

---

## [Sessões: definição funcional do MVP]

### 1) Home (porta de entrada)

**Objetivo:** sensação de “casa” + utilidade imediata.
**Conteúdo**:

* **Frase do dia** + **Dica prática** (programável via `daily_featured`).
* **Cards curtos**: “Vídeo novo da Nath”, “Pergunte à NathIA”, “Desafio do Dia”, “Registrar Hábito”.
* **CTA** para assinar (se não assinante) ou “Continuar” (se liberado para testes).
  **Dados**: `tips`, `daily_featured`, `posts` (teasers).
  **Pronto quando**: abre instantâneo, carrega 3–5 cards reais, sem erros ao tocar.

### 2) NathIA (chat)

**Objetivo:** assistência empática e rápida 24/7.
**Funcional**: chat com **contexto leve** (perfil da usuária + fase), **sugestões de prompts** (chips), histórico local, **limite de uso** p/ free.
**IA:** Gemini 2.0 Flash com system prompt seguro e barato; logs em `ai_sessions`/`ai_messages`.
**Pronto quando**: envia/recebe em <2s no 4G, não quebra com mensagens longas, tem pelo menos 6 prompts sugeridos.

### 3) MundoNath (conteúdos)

**Objetivo:** valor exclusivo e vínculo com a Nath.
**Funcional**: feed de **vídeos/artigos/audios** (player embutido), categorias (“Gestação”, “Puerpério”, “Treinos leves”, “Culinária”), **marcar como visto** e **favoritos**.
**Gating**: itens **premium (assinatura)** e **abertos** (amostra).
**Pronto quando**: lista 8–12 itens reais; player abre 100%; premium mostra paywall educado.

### 4) MãeValente (busca/curadoria com Perplexity)

**Objetivo:** respostas fundamentadas e curadas.
**Funcional**: input → resposta sucinta com **bullet points**, **fontes** (links), **salvar** em “Meus Itens”, histórico básico.
**Custo/controle**: cache por pergunta (hash) em `qa_cache` com TTL; limites por usuária.
**Pronto quando**: retorna respostas com 2–4 fontes, salva e reabre do histórico.

### 5) Meus Hábitos (rotina simples)

**Objetivo:** pequenas vitórias diárias.
**Funcional**: 3–5 hábitos predefinidos (água, respiração, alongamento curto, diário de humor, leitura curta), marcar done, **streak**, **medalhas leves**.
**Pronto quando**: marca, vê streak, recebe 1 notificação (opcional) de lembrete/dica.

---

## [Arquitetura técnica do MVP]

**App**: Expo SDK atual, **Expo Router (app/)**, **Zustand** (estado global), **EAS** (profiles: `preview`, `production`).
**Supabase**:

* **Tabelas mínimas**:
  `profiles`, `subscriptions`, `posts`, `media_assets`, `tips`, `daily_featured`,
  `ai_sessions`, `ai_messages`, `qa_cache`,
  `habits`, `habit_entries`, `favorites`.
* **Buckets**: `public-media` (aberto leitura), `premium-media` (assinantes), `user-uploads` (privado).
* **RLS (essencial)**:

  * `profiles`: owner-only.
  * `subscriptions`: owner-only; *view* de “assinante ativo”.
  * `habit_entries`, `favorites`: owner-only.
  * `posts`: público vs premium por flag; política libera premium só para assinantes **OU** testers whitelisted.
* **Edge Functions**:

  * `check-subscription` (RevenueCat/webhook futuro; no MVP, simular status).
  * `perplexity-proxy` (token server-side + rate-limit).
  * `daily-featured-rotate` (usar **pg_cron** 1×/dia).

**Tema & UI**: Tailwind 4 + shadcn/ui; design tokens centralizados (`src/theme`).
**Push**: Expo Notifications com device tokens salvos em `user_notification_tokens`.
**Analytics**: eventos: `open_app`, `view_tab`, `play_content`, `start_chat`, `send_message`, `habit_check`, `subscribe_click`, `subscribe_success/fail`.

---

## [IA e Custos]

* **NathIA (Gemini Flash)**: prompts curtos; **memória leve** (últimas 6–8 interações). Reduzir custo com: temperatura baixa, `maxTokens` com teto, truncamento progressivo.
* **MãeValente (Perplexity)**: **cache** + **limites por usuário** (p.ex., 5 consultas/dia no MVP). Mostrar 2–4 fontes.
* **Privacidade**: remover PII do contexto; logs resumidos (sem dados sensíveis).

---

## [Monetização: escolha prática para iOS/Android]

* **Teste agora**: liberar o app completo para **whitelist** de testers (sem cobrança).
* **Produção**: **In-App Subscriptions (Apple/Google)** unificadas via **RevenueCat** (recomendado).
* **Stripe** é útil para **web**; em **app** nativo, siga IAP. Pode integrar Stripe depois para landing/checkout web.

---

## [Segurança “lean” (mínimo que não quebra)]

1. **Auth Supabase** com email/OTP; perfis sincronizados.
2. **RLS ativo** nas tabelas de usuária; buckets com policies.
3. **Proxy** para Perplexity (token nunca no app).
4. **Feature flags/paywall** no servidor (view de “assinante ativo” + “tester”).
5. **Crash/analytics** sem PII; `.env` fora do bundle; chaves expostas = **NÃO**.

---

## [Roteiro do teste da influenciadora (10–12 min)]

1. Onboarding (logo + mensagem acolhedora) → Selecionar objetivos (3 chips).
2. Home: vê **Frase do dia** + 3 cards (Vídeo, NathIA, Hábito).
3. MundoNath: abre vídeo, volta; tenta premium → vê paywall suave (liberado por whitelist).
4. NathIA: envia dúvida, recebe resposta em <2s, toca sugestão de prompt.
5. MãeValente: faz 1 busca, vê fontes, salva.
6. Hábitos: marca 2 hábitos, vê streak, ganha 1 medalha.
7. Notificação: recebe 1 push “Dica da noite”.

---

## [Plano de execução em 48h (foco no que mostra valor)]

### Dia 1 — Base que funciona

* **Repo destino**: `NossaMaternidade-Private` (limpo; um só lockfile `pnpm-lock.yaml`).
* **Fix ambiente** (Windows):

  * `corepack enable`; `pnpm -v`.
  * Remover `package-lock.json`/`yarn.lock`.
  * **Expo CLI**: `pnpm dlx expo-doctor` / `pnpm dlx expo install`.
  * Se “expo not found”: `pnpm dlx expo start` (sem instalar global).
* **App**: Expo Router + tabs; tema Tailwind; tokens; ícone/splash; fontes.
* **Zustand**: session + flags (tester/assinante).
* **Supabase**: schemas + RLS mínimo + buckets; seed de `posts`, `tips`, `daily_featured`.
* **NathIA**: integração Gemini (env via server function ou Vercel AI SDK com chave segura).
* **MãeValente**: endpoint proxy + cache TTL.
* **Push**: coletar device token; enviar 1 notificação manual.

### Dia 2 — Polimento e build

* **MundoNath**: player estável, favoritos, paywall elegante.
* **Hábitos**: 5 hábitos, streak, 1 medalha.
* **Analytics**: eventos chave + tela de “Relatar problema”.
* **EAS**: `eas.json` (profiles `preview`/`production`), `app.json`/`app.config.ts` com `ios.bundleIdentifier` e `android.package`.
* **Build**: `eas build -p ios --profile preview` e `eas build -p android --profile preview`.
* **Listas de teste**: TestFlight / Android Closed Track com email da influenciadora.

---

## [Modelo de dados (essencial)]

* `profiles(id, name, stage, created_at)`
* `subscriptions(user_id, status, trial_until, updated_at)`
* `posts(id, title, type, premium, media_url, duration, tags[], published_at)`
* `tips(id, text, mood)` ; `daily_featured(date, tip_id, post_id)`
* `ai_sessions(id, user_id, started_at)` ; `ai_messages(session_id, role, content, created_at)`
* `qa_cache(hash, question, answer, sources[], ttl_expires_at)`
* `habits(id, user_id, title, icon, order)` ; `habit_entries(habit_id, date, done)`
* `favorites(user_id, post_id, created_at)`

*(RLS owner-only nas tabelas de usuária; `posts` com policy por premium/tester.)*

---

## [Riscos principais & antídotos]

* **Latência IA**: usar Gemini Flash, truncar histórico, pré-carregar sugestões.
* **Quebra em build**: travar versões via `expo install`, usar `eas build --local` se precisar depurar.
* **Custo IA**: limites diários + cache em `qa_cache`.
* **Revisão Apple/Google**: nada de “pagamento externo” para premium; use IAP em produção.

---

## [Próximas ações (objetivas)]

1. Consolidar no **NossaMaternidade-Private** com **Expo Router + tabs** e **tema** aplicado.
2. Subir **schemas + RLS** e popular `posts/tips/daily_featured`.
3. Ligar **NathIA (Gemini Flash)** e **MãeValente (Perplexity via proxy + cache)**.
4. Implementar **paywall/flags**: `tester` libera tudo; demais veem amostras.
5. **Push** habilitado e 1 campanha de teste.
6. **EAS builds** (iOS/Android) para **lista privada** da influenciadora.

Se quiser, eu já te entrego o **checklist de validação** (comandos e critérios de aceite) em formato “pronto para copiar” para o Cursor/CI.
