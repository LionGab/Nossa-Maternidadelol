# NAT-IA - Sistema Modular de IA Emp√°tica

Sistema completo de IA para Nossa Maternidade, projetado para ser emp√°tico, n√£o-julgamental e agn√≥stico de provedor de IA.

## Vis√£o Geral

NAT-IA √© composta por 9 m√≥dulos independentes que trabalham juntos para oferecer suporte completo √†s m√£es:

1. **Chat Emp√°tico** - Conversas acolhedoras e √∫teis
2. **Triagem Emocional & Risco** - Detec√ß√£o de sentimento e situa√ß√µes de risco
3. **Onboarding Inteligente** - Personaliza√ß√£o desde o in√≠cio
4. **Curadoria de Conte√∫do** - Transforma√ß√£o de conte√∫do em formatos acess√≠veis
5. **Modera√ß√£o Assistida** - Garantia de ambiente seguro
6. **Recomenda√ß√µes Personalizadas** - Sugest√µes de conte√∫do, grupos e h√°bitos
7. **H√°bitos & Coaching** - Apoio para mudan√ßa de comportamento
8. **Analytics** - Insights sem comprometer privacidade
9. **Copys Operacionais** - Textos para comunica√ß√£o

## Instala√ß√£o

```typescript
import {
  chatEmpatico,
  classificarSentimento,
  // ... outros m√≥dulos
} from '@/services/nathia';
```

## Princ√≠pios Fundamentais

### 1. Empatia Primeiro

Toda intera√ß√£o deve validar sentimentos antes de oferecer solu√ß√µes.

### 2. Zero Julgamento

Nunca comparar m√£es ou prescrever "a forma certa" de fazer as coisas.

### 3. Privacy-First

Analytics sem PII. Dados anonimizados por padr√£o.

### 4. Agn√≥stico de IA

Os m√≥dulos definem a l√≥gica. Edge Functions fazem as chamadas ao provedor de IA (Gemini, Claude, etc).

### 5. Sempre Revis√£o Humana

Copys e decis√µes cr√≠ticas sempre requerem aprova√ß√£o humana.

---

## M√≥dulo 1: Chat Emp√°tico

Interface para conversas acolhedoras com as usu√°rias.

### Exemplo de Uso

```typescript
import { chatEmpatico, createChatContext } from '@/services/nathia';

// Criar contexto da conversa
const contexto = createChatContext('user_123', {
  user_profile: {
    stage: 'mid',
    concerns: ['sono', 'amamentacao'],
  },
  current_mood: 'worried',
});

// Processar mensagem
const resposta = await chatEmpatico('Estou muito cansada e n√£o sei se consigo cuidar do beb√™', contexto);

console.log(resposta.resposta); // Resposta emp√°tica da IA
console.log(resposta.acoes); // A√ß√µes sugeridas
console.log(resposta.next_step); // Pr√≥ximo passo sugerido
```

### Funcionalidades

- ‚úÖ System prompt otimizado para empatia
- ‚úÖ Sugest√£o autom√°tica de pr√≥ximos passos
- ‚úÖ Integra√ß√£o com triagem de risco
- ‚úÖ Gerenciamento de hist√≥rico de conversa

---

## M√≥dulo 2: Triagem Emocional & Risco

Sistema de detec√ß√£o de sentimento e situa√ß√µes que requerem aten√ß√£o especial.

### Exemplo de Uso

```typescript
import { classificarSentimento, detectarRisco, acionarSOS } from '@/services/nathia';

// Classificar sentimento
const sentimento = await classificarSentimento('Estou t√£o feliz, meu beb√™ dormiu a noite toda!');
// { sentimento: "alegria", intensidade: 8, valence: "positive" }

// Detectar risco
const risco = await detectarRisco('N√£o aguento mais, quero que tudo acabe');
// { nivel: "risk", sinais: [...], confidence: 0.9 }

// Acionar SOS se necess√°rio
if (risco.nivel === 'risk') {
  const resultado = await acionarSOS('user_123', {
    mensagem: msg,
    riskAssessment: risco,
  });
  // Exibe recursos: CVV 188, SAMU 192, etc
}
```

### Funcionalidades

- ‚úÖ Classifica√ß√£o de sentimento (0-10)
- ‚úÖ Detec√ß√£o de risco em 3 n√≠veis (ok/watch/risk)
- ‚úÖ Protocolo SOS autom√°tico
- ‚úÖ Keywords configur√°veis
- ‚úÖ Recursos de apoio imediato

---

## M√≥dulo 3: Onboarding Inteligente

An√°lise de respostas e cria√ß√£o de experi√™ncia personalizada desde o in√≠cio.

### Exemplo de Uso

```typescript
import { analisarRespostas, gerarStarterPack, getOnboardingQuestions } from '@/services/nathia';

// Obter perguntas do onboarding
const perguntas = getOnboardingQuestions();

// Analisar respostas
const analise = await analisarRespostas([
  { question_id: 'stage', answer: 'Segundo trimestre', timestamp: new Date() },
  { question_id: 'concerns', answer: 'Sa√∫de do beb√™,Sono', timestamp: new Date() },
  { question_id: 'goals', answer: 'Entender desenvolvimento', timestamp: new Date() },
]);

// Gerar starter pack personalizado
const pack = await gerarStarterPack(analise.perfil);
console.log(pack.grupos); // Grupos recomendados
console.log(pack.conteudo); // Conte√∫dos iniciais
console.log(pack.welcome_message); // Mensagem de boas-vindas
```

### Funcionalidades

- ‚úÖ 4-6 perguntas essenciais pr√©-definidas
- ‚úÖ An√°lise de perfil com confidence score
- ‚úÖ Matching autom√°tico de grupos e conte√∫do
- ‚úÖ Mensagem de boas-vindas personalizada

---

## M√≥dulo 4: Curadoria de Conte√∫do

Transforma√ß√£o de conte√∫do complexo em formatos acess√≠veis.

### Exemplo de Uso

```typescript
import { resumirConteudo, criarCincoMinutos, gerarChecklist, simplificarLinguagem } from '@/services/nathia';

const artigo = `[Artigo longo sobre amamenta√ß√£o...]`;

// Resumo em 5 linhas
const resumo = await resumirConteudo(artigo);
console.log(resumo.resumo);
console.log(resumo.reading_time_minutes); // Ex: 2 minutos

// Vers√£o "Leia em 5 minutos"
const cincoMin = await criarCincoMinutos(artigo);
console.log(cincoMin.bullets); // 5 bullets pr√°ticos

// Checklist acion√°vel
const checklist = await gerarChecklist(artigo);
console.log(checklist.items); // Max 6 itens

// Simplificar linguagem t√©cnica
const simples = await simplificarLinguagem(artigo);
console.log(simples.readability_score_after); // Target: 60-70
```

### Funcionalidades

- ‚úÖ Resumos em 5 linhas
- ‚úÖ Formato "5 minutos" com bullets
- ‚úÖ Checklists acion√°veis (max 6 itens)
- ‚úÖ Simplifica√ß√£o de linguagem
- ‚úÖ C√°lculo de readability score

---

## M√≥dulo 5: Modera√ß√£o Assistida

Sistema de detec√ß√£o e corre√ß√£o de conte√∫do problem√°tico.

### Exemplo de Uso

```typescript
import { analisarMensagem, decidirAcao, sugerirReescrita } from '@/services/nathia';

// An√°lise completa
const analise = await analisarMensagem('Voc√™ DEVERIA amamentar, m√£es de verdade fazem isso');

console.log(analise.judgement_score); // 0.8 (alto)
console.log(analise.toxicity_score); // 0.3 (m√©dio)
console.log(analise.is_safe); // false

// Decis√£o autom√°tica
const acao = decidirAcao(analise);
// "review" - requer revis√£o humana

// Sugerir reescrita
if (acao === 'review') {
  const reescrita = await sugerirReescrita(mensagem);
  console.log(reescrita); // Vers√£o gentil
}

// Rationale para moderadora
console.log(analise.rationale); // Explica√ß√£o da decis√£o
```

### Funcionalidades

- ‚úÖ Detec√ß√£o de julgamento (score 0-1)
- ‚úÖ Detec√ß√£o de toxicidade (score 0-1)
- ‚úÖ Sugest√£o de reescrita emp√°tica
- ‚úÖ Decis√£o autom√°tica (approve/review/reject)
- ‚úÖ Rationale para moderadoras

---

## M√≥dulo 6: Recomenda√ß√µes Personalizadas

Algoritmo de recomenda√ß√£o de conte√∫do, c√≠rculos e h√°bitos.

### Exemplo de Uso

```typescript
import { recomendarConteudo, recomendarCirculo, recomendarHabito } from '@/services/nathia';

// Recomendar conte√∫do
const conteudos = await recomendarConteudo('user_123', {
  current_stage: 'mid',
  current_mood: 'worried',
  recent_activity: ['sono', 'amamentacao'],
});

console.log(conteudos.itens); // Top 5 conte√∫dos
console.log(conteudos.justificativa); // Por que foram recomendados

// Recomendar c√≠rculos
const circulos = await recomendarCirculo('user_123', {
  stage: 'mid',
  concerns: ['sono', 'saude_mental'],
});

console.log(circulos.circulos); // Top 3 c√≠rculos
console.log(circulos.match_scores); // Scores de cada um

// Recomendar h√°bito
const habito = await recomendarHabito('user_123', {
  goals: ['saude_mental', 'autocuidado'],
});

console.log(habito.habito); // H√°bito recomendado
console.log(habito.micro_objetivos); // Passos para come√ßar
```

### Funcionalidades

- ‚úÖ Algoritmo baseado em contexto + hist√≥rico
- ‚úÖ Match scores transparentes
- ‚úÖ Justificativas claras
- ‚úÖ Re-ranking com feedback
- ‚úÖ Apenas 1 h√°bito por vez (n√£o sobrecarregar)

---

## M√≥dulo 7: H√°bitos & Coaching

Sistema de cria√ß√£o e acompanhamento de h√°bitos com mensagens motivacionais.

### Exemplo de Uso

```typescript
import { criarMicroObjetivo, gerarMensagemMotivacional, trackProgresso, registrarCompletude } from '@/services/nathia';

// Criar micro-objetivo
const micro = await criarMicroObjetivo('Quero fazer exerc√≠cios regularmente');

console.log(micro.titulo); // "Come√ßar com 5 minutos"
console.log(micro.passos); // [passo 1, passo 2, ...]
console.log(micro.prazo_dias); // 7

// Rastrear progresso
const progresso = await trackProgresso('user_123', 'habit_1');
console.log(progresso.streak); // 3 dias seguidos
console.log(progresso.completude); // 45%

// Gerar mensagem motivacional
const msg = gerarMensagemMotivacional(progresso);
console.log(msg.mensagem); // "3 dias seguidos! Voc√™ est√°..."
console.log(msg.avoid_comparison); // true (NUNCA compara com outras)

// Registrar completude
await registrarCompletude('user_123', 'habit_1');
```

### Funcionalidades

- ‚úÖ Micro-objetivos acion√°veis (3-5 passos)
- ‚úÖ Mensagens motivacionais N√ÉO comparativas
- ‚úÖ Lembretes gentis
- ‚úÖ Tracking de streak e completude
- ‚úÖ Identifica√ß√£o de barreiras

---

## M√≥dulo 8: Analytics

Sistema de extra√ß√£o de insights mantendo privacidade (sem PII).

### Exemplo de Uso

```typescript
import { extrairRotulos, anonimizar, gerarMetricas, validarConformidadeLGPD } from '@/services/nathia';

// Extrair r√≥tulos
const labels = await extrairRotulos('Estou muito preocupada com o sono do meu beb√™');

console.log(labels.tema); // ["sono", "preocupacao"]
console.log(labels.humor); // "negative"
console.log(labels.fase); // "postpartum"
console.log(labels.urgency); // "medium"

// Anonimizar dados
const dadosOriginais = {
  user_id: 'user_123',
  name: 'Maria Silva',
  message: 'Estou gr√°vida de 20 semanas',
  email: 'maria@email.com',
};

const dadosSeguros = anonimizar(dadosOriginais);
// Remove: user_id, name, email
// Mant√©m: metadados estruturados

// Gerar m√©tricas agregadas
const metrics = gerarMetricas(arrayDeInteracoes);
console.log(metrics.topics_freq); // { sono: 45, amamentacao: 32 }
console.log(metrics.sentiment_dist); // { positive: 0.3, neutral: 0.5, ... }

// Validar conformidade LGPD
const validacao = validarConformidadeLGPD(dados);
console.log(validacao.compliant); // true/false
console.log(validacao.violations); // Lista de problemas
```

### Funcionalidades

- ‚úÖ R√≥tulos estruturados (tema, humor, fase)
- ‚úÖ Anonimiza√ß√£o autom√°tica de PII
- ‚úÖ M√©tricas agregadas
- ‚úÖ Valida√ß√£o de conformidade LGPD/GDPR
- ‚úÖ Export para dashboard

---

## M√≥dulo 9: Copys Operacionais

Gera√ß√£o de textos para push, email e App Store (SEMPRE requer revis√£o humana).

### Exemplo de Uso

```typescript
import { gerarPushNotification, gerarEmail, gerarAppStoreCopy, validarCopyBrand } from '@/services/nathia';

// Push notification
const push = await gerarPushNotification({ user_stage: 'mid', event: 'new_content' }, 'content_alert');

console.log(push.titulo); // "Novo conte√∫do para voc√™ üåü"
console.log(push.corpo); // "Acabamos de publicar..."
console.log(push.requires_human_review); // SEMPRE true

// Email
const email = await gerarEmail('welcome', {
  user_name: 'Maria',
});

console.log(email.subject); // "Bem-vinda √† Nossa Maternidade!"
console.log(email.html); // HTML completo
console.log(email.text); // Vers√£o texto

// App Store copy
const copy = await gerarAppStoreCopy('nathia_chat');
console.log(copy.titulo); // "NAT-IA: Assistente Emp√°tica"
console.log(copy.descricao); // Descri√ß√£o completa
console.log(copy.keywords); // ["maternidade", "chat", ...]

// Validar contra diretrizes da marca
const validacao = validarCopyBrand('Voc√™ deveria fazer X');
console.log(validacao.valid); // false
console.log(validacao.issues); // ["Tom prescritivo detectado"]
console.log(validacao.suggestions); // ["Use 'pode', 'uma op√ß√£o √©'"]
```

### Funcionalidades

- ‚úÖ Push notifications (titulo max 40, corpo max 120 chars)
- ‚úÖ Emails com templates
- ‚úÖ App Store copy
- ‚úÖ Microcopy para UI
- ‚úÖ Valida√ß√£o contra diretrizes da marca
- ‚úÖ **SEMPRE marca requires_human_review: true**

---

## Configura√ß√£o

Todas as configura√ß√µes est√£o centralizadas em `config.ts`:

```typescript
import { NATHIA_CONFIG, updateConfig } from '@/services/nathia';

// Acessar configura√ß√£o
console.log(NATHIA_CONFIG.triagem.keywords_risco_alto);
console.log(NATHIA_CONFIG.moderacao.judgement_threshold);

// Atualizar em runtime (com cuidado!)
updateConfig(['triagem', 'threshold_risco_alto'], 0.8);

// Validar configura√ß√£o
import { validateConfig } from '@/services/nathia';
const isValid = validateConfig(); // true/false
```

### Configura√ß√µes Principais

- `triagem` - Keywords de risco, thresholds
- `onboarding` - Perguntas, min respostas
- `curadoria` - Tamanhos, readability targets
- `moderacao` - Thresholds de aprova√ß√£o/rejei√ß√£o
- `recomendacoes` - Pesos do algoritmo, min match score
- `habitos` - Prazos, frequ√™ncia de lembretes
- `analytics` - Reten√ß√£o, categorias padronizadas
- `copys` - Limites de caracteres

---

## Uso com Edge Functions

Os m√≥dulos da NAT-IA s√£o agn√≥sticos de IA. Edge Functions fazem as chamadas reais:

```typescript
// Edge Function: /functions/nathia-chat/index.ts
import { chatEmpatico, buildChatPrompt } from '@/services/nathia';
import { GoogleGenerativeAI } from '@google/generative-ai';

Deno.serve(async (req) => {
  const { mensagem, contexto } = await req.json();

  // 1. NAT-IA prepara a l√≥gica
  const chatSetup = await chatEmpatico(mensagem, contexto);
  const prompt = buildChatPrompt(mensagem, contexto);

  // 2. Edge Function chama o Gemini
  const genAI = new GoogleGenerativeAI(Deno.env.get('GEMINI_API_KEY'));
  const model = genAI.getGenerativeModel({ model: 'gemini-pro' });
  const result = await model.generateContent(prompt);

  // 3. Retorna resposta combinada
  return new Response(
    JSON.stringify({
      ...chatSetup,
      resposta: result.response.text(),
    })
  );
});
```

---

## Health Check

```typescript
import { healthCheck } from '@/services/nathia';

const status = healthCheck();
console.log(status.status); // "healthy" | "degraded" | "unhealthy"
console.log(status.modules); // Status de cada m√≥dulo
console.log(status.config_valid); // Configura√ß√£o v√°lida?
console.log(status.version); // "1.0.0"
```

---

## Error Handling

Todos os m√≥dulos usam erros tipados:

```typescript
import { NathiaError, ValidationError, AIServiceError } from '@/services/nathia';

try {
  await chatEmpatico('', contexto);
} catch (error) {
  if (error instanceof ValidationError) {
    console.error('Entrada inv√°lida:', error.message);
  } else if (error instanceof AIServiceError) {
    console.error('Servi√ßo de IA falhou:', error.message);
  } else if (error instanceof NathiaError) {
    console.error('Erro NAT-IA:', error.code, error.details);
  }
}
```

---

## Testes

```typescript
// Exemplo de teste
import { classificarSentimento } from '@/services/nathia';

describe('Triagem - Classificar Sentimento', () => {
  it('deve classificar sentimento positivo', async () => {
    const resultado = await classificarSentimento('Estou t√£o feliz com meu beb√™!');

    expect(resultado.valence).toBe('positive');
    expect(resultado.intensidade).toBeGreaterThan(5);
  });

  it('deve rejeitar mensagem vazia', async () => {
    await expect(classificarSentimento('')).rejects.toThrow(ValidationError);
  });
});
```

---

## Roadmap

### v1.1 (Pr√≥ximo)

- [ ] Cache de respostas frequentes
- [ ] Suporte a m√∫ltiplos idiomas
- [ ] A/B testing integrado
- [ ] M√©tricas de qualidade de respostas

### v2.0 (Futuro)

- [ ] Multi-modal (voz, imagem)
- [ ] Personaliza√ß√£o por perfil psicol√≥gico
- [ ] Integra√ß√£o com wearables
- [ ] Predi√ß√£o de necessidades

---

## Contribuindo

### Princ√≠pios de Design

1. **Empatia acima de efici√™ncia** - Preferir resposta calorosa a resposta r√°pida
2. **Privacidade por padr√£o** - Nunca armazenar PII desnecess√°rio
3. **Valida√ß√£o humana** - IA sugere, humanos decidem
4. **Transpar√™ncia** - Sempre explicar por que uma decis√£o foi tomada
5. **Inclusividade** - Considerar diversidade de experi√™ncias maternas

### Code Style

- TypeScript strict mode
- JSDoc em todas as fun√ß√µes p√∫blicas
- Testes para casos cr√≠ticos
- Error handling robusto

---

## Licen√ßa

Propriedade de Nossa Maternidade. Uso interno apenas.

---

## Suporte

Para d√∫vidas sobre NAT-IA:

- Documenta√ß√£o: Este README
- Issues: GitHub Issues
- Contato: equipe-tech@nossamaternidade.com.br

**NAT-IA v1.0.0** - Sistema de IA Emp√°tica para Nossa Maternidade
